@(queryForm: Form[DBQuery], histories: List[DBQueryHistory], queryResult: Option[DBQueryResult]=None)

@import helper._
@import helper.twitterBootstrap._

@main {
  <style>
    #sql {
      height: 200px;
      font-size: 18px;
      font-family: monospace;
    }
    .btn-primary {
      margin-right: 20px;
    }
  </style>
  <script>
    function deleteHistory(id) {
      jsRouter.controllers.Application.removeQueryHistory(id).ajax({
        complete: function() { window.location = '@routes.Application.index(None)' }
      });
    }
  </script>
}{
  <div class="span8">
    <section id="querypad">
    @queryForm.globalError.map { err =>
      <div class="alert alert-block alert-error">
          <button type="button" class="close" data-dismiss="alert">&times;</button>
          <h4>SQL エラー</h4>
          @err.message
      </div>
    }
      <div>
        @helper.form(action = routes.Application.executeQuery) {
          <fieldset>
            <legend>SQL入力欄</legend>
            @textarea(queryForm("sql"), 'class -> "span12", '_label -> "", '_showConstraints -> false)
            <div class="row-fluid">
              <div class="span4">
                <button type="submit" class="btn btn-primary">実行</button>
                <button type="submit" class="btn csv-download" name="submit-csv">CSV ダウンロード</button>
              </div>
              <div class="span8">
                <label class="checkbox">履歴に保存
                  <input type="checkbox" id="save" name="save" value="true"/>
                </label>
                <input class="span6" type="text" id="name" name="name" placeholder="履歴の名前"/>
              </div>
            </div>
          </fieldset>
        }
      </div>
    @queryResult.map { qr =>
      <h2>実行結果</h2>
      @if(qr.rows.length == 0) {
        <p class="alert">クエリの実行には成功しましたが、結果が 0 件です。</p>
      } else {
        <table class="table table-bordered table-condensed table-striped">
          <thead>
            <tr>
            @qr.columns.map { column =>
              <th>@column</th>
            }
            </tr>
          </thead>
          <tbody>
          @qr.rows.map { row =>
            <tr>
            @row.map { value =>
              <td>@value</td>
            }
            </tr>
          }
          </tbody>
        </table>
      }
    }
    </section>
  </div><!--/span-->
  <div class="span4">
    <div class="well sidebar-nav">
      <ul class="nav nav-list">
        <li class="nav-header">SQL 履歴</li>
      @histories.map { history =>
        <li>
        <button class="close delete" type="button"
                onclick="if (confirm('削除しますか?')) { deleteHistory(@history.id.getOrElse(0)) } ">×</button>
          <a rel="tooltip" href="@routes.Application.index(history.id.toOption)"
               data-placement="left" data-original-title="@history.query.sql"
               >@history.updatedAt.toString("M/dd HH:mm") @history.name</a>
        </li>
      }
      </ul>
    </div><!--/.well -->
  </div><!--/span-->
    
} {
  <script>
    $(function(){
      $('a[rel=tooltip]').tooltip();
    });
  </script>
}
